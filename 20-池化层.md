# 20 - æ± åŒ–å±‚

### ğŸ¦ æœ¬èŠ‚è¯¾ç¨‹è§†é¢‘åœ°å€ ğŸ‘‰[![Bilibil](https://i1.hdslb.com/bfs/archive/ed34f0da8524120e89920d138732a524b9c0ceaa.jpg@640w_400h_100Q_1c.webp)](https://www.bilibili.com/video/BV1EV411j7nX)
## æ± åŒ–å±‚ ï¼ˆPoolingï¼‰

**Problem**
å·ç§¯å±‚çš„ç§¯å¯¹ä½ç½®æ•æ„Ÿï¼Œæ£€æµ‹å‚ç›´è¾¹ç¼˜

å› æ­¤éœ€è¦ä¸€å®šç¨‹åº¦çš„å¹³ç§»ä¸å˜æ€§ï¼ˆç…§æ˜ã€ç‰©ä½“ä½ç½®ã€æ¯”ä¾‹ã€å¤–è§‚ç­‰ç­‰å› ç´ ï¼‰

## äºŒç»´æœ€å¤§æ± åŒ–

![](Images/ä¸‹è¼‰.png)

å’Œå·ç§¯å±‚ç±»ä¼¼ï¼Œä¹Ÿæœ‰å¡«å……å’Œæ­¥å¹…ï¼Œä½†æ²¡æœ‰å¯å­¦ä¹ çš„å‚æ•°

åœ¨æ¯ä¸ªè¾“å…¥é€šé“åº”ç”¨æ± åŒ–å±‚ä»¥è·å¾—ç›¸åº”çš„è¾“å‡ºé€šé“
è¾“å‡ºé€šé“æ•°=è¾“å…¥é€šé“æ•°

è¾“å‡ºæ¯ä¸ªçª—å£æœ€å¼ºçš„ä¿¡å·

## å¹³å‡æ± åŒ–å±‚

![](\Images/Screenshot-2019-07-21-at-3.05.56-AM.png)

**æ€»ç»“**

æ± åŒ–å±‚ç¼“è§£äº†å·ç§¯å±‚çš„ä½ç½®æ•æ„Ÿæ€§ï¼Œé€šå¸¸ä½äºå·ç§¯å±‚ä¹‹åï¼Œä½¿è¾¹ç•Œæ•ˆæœå¾—åˆ°å¼ºåŒ–ã€‚

![](\Images/1_fpmtYoP9e8hycFIILPfW5A.png)

## ä»£ç å®ç°

```
#æ‰‹åŠ¨å®ç°
import torch
from torch import nn
from d2l import torch as d2l

def pool2d(X, pool_size, mode='max'):
    p_h, p_w = pool_size
    Y = torch.zeros((X.shape[0] - p_h + 1, X.shape[1] - p_w + 1))
    for i in range(Y.shape[0]):
        for j in range(Y.shape[1]):
            if mode == 'max':
                Y[i, j] == X[i:i + p_h, j:j + p_w].max()
                #jå–æœ€å¤§å€¼ï¼Œä»X.shape[1]-p_wåˆ°X.shape[1]ï¼ŒèŒƒå›´åˆšåˆšå¥½
    
            elif mode == 'avg':
                Y[i, j] == X[i:i + p_h, j:j + p_w].mean()
    return Y

#è°ƒç”¨æ¨¡å—
pool2d = nn.MaxPool2d(3)
#kernel_size=3
#strideï¼š Default value is kernel_size.
pool2d(X)

#å¤šé€šé“
X = torch.cat((X, X + 1), 1)
#dim=1
X.shape

pool2d = nn.MaxPool2d(3, padding=1, stride=2)
pool2d(X).shape
```