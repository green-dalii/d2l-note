# 20 - æ± åŒ–å±‚

---

### ğŸ¦ æœ¬èŠ‚è¯¾ç¨‹è§†é¢‘åœ°å€ ğŸ‘‡

[![Bilibil](https://i1.hdslb.com/bfs/archive/ed34f0da8524120e89920d138732a524b9c0ceaa.jpg@640w_400h_100Q_1c.webp)](https://www.bilibili.com/video/BV1EV411j7nX)

## æ± åŒ–å±‚ ï¼ˆPoolingï¼‰

é€šå¸¸å½“æˆ‘ä»¬å¤„ç†å›¾åƒæ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›é€æ¸é™ä½éšè—è¡¨ç¤ºçš„ç©ºé—´åˆ†è¾¨ç‡ã€èšé›†ä¿¡æ¯ï¼Œè¿™æ ·éšç€æˆ‘ä»¬åœ¨ç¥ç»ç½‘ç»œä¸­å±‚å çš„ä¸Šå‡ï¼Œæ¯ä¸ªç¥ç»å…ƒå¯¹å…¶æ•æ„Ÿçš„æ„Ÿå—é‡ï¼ˆè¾“å…¥ï¼‰å°±è¶Šå¤§ã€‚

è€Œæˆ‘ä»¬çš„æœºå™¨å­¦ä¹ ä»»åŠ¡é€šå¸¸ä¼šè·Ÿå…¨å±€å›¾åƒçš„é—®é¢˜æœ‰å…³ï¼ˆä¾‹å¦‚ï¼Œâ€œå›¾åƒæ˜¯å¦åŒ…å«ä¸€åªçŒ«å‘¢ï¼Ÿâ€ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ€åä¸€å±‚çš„ç¥ç»å…ƒåº”è¯¥å¯¹æ•´ä¸ªè¾“å…¥çš„å…¨å±€æ•æ„Ÿã€‚é€šè¿‡é€æ¸èšåˆä¿¡æ¯ï¼Œç”Ÿæˆè¶Šæ¥è¶Šç²—ç³™çš„æ˜ å°„ï¼Œæœ€ç»ˆå®ç°å­¦ä¹ å…¨å±€è¡¨ç¤ºçš„ç›®æ ‡ï¼ŒåŒæ—¶å°†å·ç§¯å›¾å±‚çš„æ‰€æœ‰ä¼˜åŠ¿ä¿ç•™åœ¨ä¸­é—´å±‚ã€‚

å½“æ£€æµ‹è¾ƒåº•å±‚çš„ç‰¹å¾æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸å¸Œæœ›è¿™äº›ç‰¹å¾ä¿æŒæŸç§ç¨‹åº¦ä¸Šçš„å¹³ç§»ä¸å˜æ€§ã€‚

### äºŒç»´æœ€å¤§æ± åŒ–

![pooling](Images/pooling.gif)

- å’Œå·ç§¯å±‚ç±»ä¼¼ï¼Œä¹Ÿæœ‰å¡«å……å’Œæ­¥å¹…ï¼Œä½†æ²¡æœ‰å¯å­¦ä¹ çš„å‚æ•°
- åœ¨æ¯ä¸ªè¾“å…¥é€šé“åº”ç”¨æ± åŒ–å±‚ä»¥è·å¾—ç›¸åº”çš„è¾“å‡ºé€šé“
- è¾“å‡ºé€šé“æ•°=è¾“å…¥é€šé“æ•°
- è¾“å‡ºæ¯ä¸ªçª—å£æœ€å¼ºçš„ä¿¡å·

### å¹³å‡æ± åŒ–å±‚

![average_pooling](Images/Screenshot-2019-07-21-at-3.05.56-AM.png)

![max&average pooling](Images/1_fpmtYoP9e8hycFIILPfW5A.png)

### æ€»ç»“

- å¯¹äºç»™å®šè¾“å…¥å…ƒç´ ï¼Œæœ€å¤§æ± åŒ–å±‚ä¼šè¾“å‡ºè¯¥çª—å£å†…çš„æœ€å¤§å€¼ï¼Œå¹³å‡æ± åŒ–å±‚ä¼šè¾“å‡ºè¯¥çª—å£å†…çš„å¹³å‡å€¼ã€‚
- æ± åŒ–å±‚çš„ä¸»è¦ä¼˜ç‚¹ä¹‹ä¸€æ˜¯å‡è½»å·ç§¯å±‚å¯¹ä½ç½®çš„è¿‡åº¦æ•æ„Ÿã€‚
- æˆ‘ä»¬å¯ä»¥æŒ‡å®šæ± åŒ–å±‚çš„å¡«å……å’Œæ­¥å¹…ã€‚
- ä½¿ç”¨æœ€å¤§æ± åŒ–å±‚ä»¥åŠå¤§äº 1 çš„æ­¥å¹…ï¼Œå¯å‡å°‘ç©ºé—´ç»´åº¦ï¼ˆå¦‚é«˜åº¦å’Œå®½åº¦ï¼‰ã€‚
- æ± åŒ–å±‚çš„è¾“å‡ºé€šé“æ•°ä¸è¾“å…¥é€šé“æ•°ç›¸åŒã€‚

## ä»£ç å®ç°

- ä»é›¶å®ç°

```python
import torch
from torch import nn
from d2l import torch as d2l

def pool2d(X, pool_size, mode='max'):
    p_h, p_w = pool_size
    Y = torch.zeros((X.shape[0] - p_h + 1, X.shape[1] - p_w + 1))
    for i in range(Y.shape[0]):
        for j in range(Y.shape[1]):
            if mode == 'max':
                Y[i, j] == X[i:i + p_h, j:j + p_w].max()
            elif mode == 'avg':
                Y[i, j] == X[i:i + p_h, j:j + p_w].mean()
    return Y
```

- ç®€æ´å®ç°

```python
#kernel_size=3
#æ± åŒ–å±‚é»˜è®¤çš„stride=kernel size
pool2d = nn.MaxPool2d(3)
pool2d(X)

#å¤šé€šé“
X = torch.cat((X, X + 1), 1)
#dim=1
X.shape

pool2d = nn.MaxPool2d(3, padding=1, stride=2)
pool2d(X).shape
```

## Pytorch æ¨¡å—å‚è€ƒæ–‡æ¡£

- `torch.nn.MaxPool2d(kernel_size, stride=None, padding=0, dilation=1, return_indices=False, ceil_mode=False)`Pytorch 2D æœ€å¤§æ± åŒ–å±‚ ğŸ§[ä¸­æ–‡](https://pytorch-cn.readthedocs.io/zh/latest/package_references/torch-nn/#_2) | [å®˜æ–¹è‹±æ–‡](https://pytorch.org/docs/stable/generated/torch.nn.MaxPool2d.html#torch.nn.MaxPool2d)
- `torch.nn.AvgPool2d(kernel_size, stride=None, padding=0, ceil_mode=False, count_include_pad=True, divisor_override=None)`Pytorch 2D å¹³å‡æ± åŒ–å±‚ ğŸ§[ä¸­æ–‡](https://pytorch-cn.readthedocs.io/zh/latest/package_references/torch-nn/#_2) | [å®˜æ–¹è‹±æ–‡](https://pytorch.org/docs/stable/generated/torch.nn.AvgPool2d.html#torch.nn.AvgPool2d)

---

## Q&AğŸ¤“

**Qï¼šä¸ºä»€ä¹ˆç°åœ¨ç”¨æ± åŒ–å±‚æ¯”è¾ƒå°‘ï¼Ÿ**

**ğŸ™‹â€â™‚ï¸**ï¼šæ²ç¥è®¤ä¸ºï¼Œä¸€æ–¹é¢ç°åœ¨å¤šç”¨å·ç§¯å±‚åŠ  stride æ¥å‡å°è®¡ç®—é‡ï¼Œå¦ä¸€æ–¹é¢ç›®å‰ä¹Ÿä½¿ç”¨äº†è®¸å¤šæ•°æ®å¢å¼ºï¼ˆArgumentï¼‰çš„æ–¹æ³•ï¼Œæ•ˆæœä¸æ± åŒ–ç±»ä¼¼ã€‚
