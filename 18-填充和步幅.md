# 18 - å·ç§¯å±‚ä¸­çš„å¡«å……å’Œæ­¥å¹…

### ğŸ¦ æœ¬èŠ‚è¯¾ç¨‹è§†é¢‘åœ°å€ ğŸ‘‰[![Bilibil](https://i1.hdslb.com/bfs/archive/52db906a4e9c54589a4486e323534913f0731a1f.jpg@640w_400h_100Q_1c.webp)](https://www.bilibili.com/video/BV1Th411U7UN)
## å¡«å……å’Œæ­¥å¹…

ç»™å®š$(32\times32)$è¾“å…¥å›¾åƒï¼Œåº”ç”¨$(5\times5)$å·ç§¯æ ¸ï¼Œç¬¬$1$å±‚å¾—åˆ°è¾“å‡ºå¤§å°$28\times28$ï¼Œç¬¬$7$å±‚å¾—åˆ°è¾“å‡ºå¤§å°$4\times4$ã€‚

æ›´å¤§çš„å·ç§¯æ ¸å¯ä»¥æ›´å¿«åœ°å‡å°è¾“å‡ºå¤§å°ï¼šå½¢çŠ¶ä»$n_k\times n_w$å‡å°åˆ°$(n_h-n_k+1)\times(n_w-k_w+1)$

![](\Images/0rs9l.gif)

### å¡«å……

åœ¨è¾“å…¥å‘¨å›´æ·»åŠ é¢å¤–çš„è¡Œå’Œåˆ—ã€‚

å¡«å……$p_h$è¡Œå’Œ$p_w$åˆ—ï¼Œè¾“å‡ºå½¢çŠ¶ä¸ºï¼š

$$(n_h-k_h+p_h+1)\times(n_w-k_w+p_w+1)$$

é€šå¸¸å–$p_h=k_h-1$ï¼Œ$p_w=k_w-1$ï¼Œä½¿è¾“å…¥è¾“å‡ºå½¢çŠ¶ç›¸åŒï¼›

å½“$k_h$ä¸ºå¥‡æ•°ï¼šåœ¨ä¸Šä¸‹ä¸¤ä¾§å¡«å……$p_h/2$
å½“$k_h$ä¸ºå¶æ•°ï¼šåœ¨ä¸Šä¾§å¡«å……$\lceil p_h/2\rceil$ï¼Œä¸‹ä¾§å¡«å……$\lfloor p_h/2\rfloor$

### æ­¥å¹…

å¡«å……å‡å°çš„è¾“å‡ºå¤§å°ä¸å±‚æ•°çº¿æ€§ç›¸å…³ï¼šç»™å®šè¾“å…¥å¤§å°$224\times 224$ï¼Œåœ¨ä½¿ç”¨$5\times5$å·ç§¯æ ¸çš„æƒ…å†µä¸‹ï¼Œéœ€è¦$55$å±‚å°†è¾“å‡ºé™ä½åˆ°$4\times4$ï¼Œæ‰€ä»¥éœ€è¦çš„å¤§é‡çš„è¾“å…¥å±‚ã€‚

![](\Images/src=http___img-blog.csdnimg.cn_20210329203509241.gif&refer=http___img-blog.csdnimg.gif)

æ­¥å¹…æ˜¯æŒ‡è¡Œã€åˆ—çš„æ»‘åŠ¨è¡¥å¿ã€‚

ç»™å®šé«˜åº¦$s_h$å’Œå®½åº¦$s_w$çš„æ­¥å¹…ï¼Œè¾“å‡ºå½¢çŠ¶æ˜¯ï¼š

$$\lfloor(n_h-k_h+p_h+s_h)/s_h\rfloor\times\lfloor(n_w-k_w+p_w+s_w)/s_w\rfloor$$

å¦‚æœ$p_h=k_h-1$ï¼Œ$p_w=k_w-1$

$$\lfloor(n_h+s_h-1)/s_h\rfloor\times\lfloor(n_w+s_w-1)/s_w\rfloor$$

å¦‚æœè¾“å…¥é«˜åº¦å’Œå®½åº¦å¯ä»¥è¢«æ­¥å¹…æ•´é™¤ï¼ˆæ­¥å¹…ä¸å·ç§¯æ ¸å¤§å°ç›¸å½“ï¼‰

$$(n_h/s_h)\times(n_w/s_w)$$

å¡«å……å’Œæ­¥å¹…ä½¿å·ç§¯å±‚çš„è¶…å‚æ•°ï¼›

å¡«å……åœ¨è¾“å…¥å‘¨å›´æ·»åŠ é¢å¤–çš„è¡Œã€åˆ—ï¼Œæ¥æ§åˆ¶è¾“å‡ºå½¢çŠ¶çš„å‡å°‘é‡ï¼›

æ­¥å¹…æ˜¯æ¯æ¬¡æ»‘åŠ¨æ ¸çª—å£æ—¶çš„è¡Œã€åˆ—æ­¥é•¿ï¼Œå¯ä»¥æˆå€åœ°å‡å°‘è¾“å‡ºå½¢çŠ¶ã€‚

## ä»£ç å®ç°

![](\Images/1_ulfFYH5HbWpLTIfuebj5mQ.gif)

**padding**

```
import torch
from torch import nn

def comp_conv2d(conv2d, X):
    X = X.reshape((1, 1) + X.shape)
    #ï¼ˆ1ï¼Œ1ï¼‰ä»£è¡¨input_channel=1, batch_size=1
    Y = conv2d(X)
    return Y.reshape(Y.shape[2:])
    #Y.shape returns tensor(1,1,8,8), slice[2:] returns tensor(8,8)

conv2d = nn.Conv2d(1, 1, kernel_size=3, padding=1)
#3*3
#padding=1è¡¨ç¤ºä¸Šä¸‹å·¦å³å„å¡«å……1, 10*10
X = torch.rand(size=(8, 8))
comp_conv2d(conv2d, X).shape
```
```
conv2d = nn.Conv2d(1, 1, kernel_size=(5, 3), padding=(2, 1))
#12*10
comp_conv2d(conv2d, X).shape
#8*8
```
**stride**

```
conv2d = nn.Conv2d(1, 1, kernel_size=3, padding=1, stride=2)
##10*10
comp_conv2d(conv2d, X).shape
##(10-3)/2+1=4.5, 4*4
```
```
conv2d = nn.Conv2d(1, 1, kernel_size=(3, 5), padding=(0, 1), stride=(3, 4))
### 8*10 3*5 3*4
### floor[ï¼ˆ8-3ï¼‰/3+1]=2 florr[(10-5)/4+1]=2
comp_conv2d(conv2d, X).shape
```