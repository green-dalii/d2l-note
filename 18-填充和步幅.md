# 18 - å·ç§¯å±‚ä¸­çš„å¡«å……å’Œæ­¥å¹…

---

### ğŸ¦ æœ¬èŠ‚è¯¾ç¨‹è§†é¢‘åœ°å€ ğŸ‘‡

[![Bilibil](https://i1.hdslb.com/bfs/archive/52db906a4e9c54589a4486e323534913f0731a1f.jpg@640w_400h_100Q_1c.webp)](https://www.bilibili.com/video/BV1Th411U7UN)

## å¡«å……å’Œæ­¥å¹…

å‡è®¾è¾“å…¥å½¢çŠ¶ä¸º $n_h \times n_w$ ï¼Œå·ç§¯æ ¸å½¢çŠ¶ä¸º $k_h\times k_w$ ï¼Œé‚£ä¹ˆè¾“å‡ºå½¢çŠ¶å°†æ˜¯ $(n_hâˆ’k_h+1)\times(n_wâˆ’k_w+1)$ ã€‚ å› æ­¤ï¼Œå·ç§¯çš„è¾“å‡ºå½¢çŠ¶å–å†³äºè¾“å…¥å½¢çŠ¶å’Œå·ç§¯æ ¸çš„å½¢çŠ¶ã€‚

é™¤äº†ä»¥ä¸Šçš„ä¸¤ä¸ªå› ç´ å¤–ï¼Œ**å¡«å……ï¼ˆpaddingï¼‰** å’Œ **æ­¥å¹…ï¼ˆstrideï¼‰** ä¹Ÿä¼šå½±å“å¤§å°ã€‚

ç»™å®š$(32\times32)$åƒç´ çš„è¾“å…¥å›¾åƒï¼Œåº”ç”¨$(5\times5)$å·ç§¯æ ¸

- ç¬¬$1$å±‚å¾—åˆ°è¾“å‡ºå¤§å°$28\times28$
- ç¬¬$7$å±‚å¾—åˆ°è¾“å‡ºå¤§å°$4\times4$ã€‚

æ›´å¤§çš„å·ç§¯æ ¸å¯ä»¥æ›´å¿«åœ°å‡å°è¾“å‡ºå¤§å°ï¼šå½¢çŠ¶ä»$n_k\times n_w$å‡å°åˆ°$(n_h-n_k+1)\times(n_w-k_w+1)$ï¼Œå¦‚æœéœ€è¦åšæ›´æ·±çš„ç¥ç»ç½‘ç»œï¼Œé‚£ä¹ˆå°±éœ€è¦åˆ«çš„æ–¹æ³•é™ä½ç¼©å°ä½œç”¨ã€‚

### å¡«å……ï¼ˆPaddingï¼‰ï¼šå¢å¤§è¾“å‡ºå°ºå¯¸

å‡å¦‚æˆ‘ä»¬ä¸æƒ³è®©è¾“å‡ºå˜å°ï¼ˆç”šè‡³æ‰©å¤§ï¼‰ï¼Œä¸€ç§æ–¹æ³•å¯ä»¥åœ¨è¾“å…¥å‘¨å›´æ·»åŠ é¢å¤–çš„è¡Œå’Œåˆ—ã€‚

![padding](Images/0rs9l.gif)

![conv-pad](https://zh.d2l.ai/_images/conv-pad.svg)

å¦‚å¡«å……$p_h$è¡Œå’Œ$p_w$åˆ—å…¨ 0 å…ƒç´ ï¼Œåˆ™è¾“å‡ºå½¢çŠ¶ä¸ºï¼š

$$(n_h-k_h+p_h+1)\times(n_w-k_w+p_w+1)$$

é€šå¸¸å–$p_h=k_h-1$ï¼Œ$p_w=k_w-1$ï¼Œä½¿è¾“å…¥è¾“å‡ºå½¢çŠ¶ç›¸åŒï¼›

- å½“$k_h$ä¸ºå¥‡æ•°ï¼šåœ¨ä¸Šä¸‹å·¦å³å„å¡«å……$p_h/2$
- å½“$k_h$ä¸ºå¶æ•°ï¼šåœ¨ä¸Šä¾§å¡«å……$\lceil p_h/2\rceil$ï¼Œä¸‹ä¾§å¡«å……$\lfloor p_h/2\rfloor$

### æ­¥å¹…ï¼ˆStrideï¼‰ï¼šå‡å°è¾“å‡ºå°ºå¯¸

![no_padding_strides](Images/no_padding_strides.gif)

å¡«å……å‡å°çš„è¾“å‡ºå¤§å°ä¸å±‚æ•°çº¿æ€§ç›¸å…³ï¼š

- ç»™å®šè¾“å…¥å¤§å°$224\times 224$ï¼Œåœ¨ä½¿ç”¨$5\times5$å·ç§¯æ ¸çš„æƒ…å†µä¸‹ï¼Œéœ€è¦ 55 ä¸ªå·ç§¯å±‚
- éœ€è¦å¤§é‡è®¡ç®—æ‰èƒ½å¾—åˆ°è¾ƒå°çš„è¾“å‡º

![conv-stride](https://zh.d2l.ai/_images/conv-stride.svg)

æ­¥å¹…æ˜¯æŒ‡è¡Œã€åˆ—çš„æ»‘åŠ¨è¡¥å¿ã€‚é»˜è®¤æ­¥å¹…ä¸º 1ï¼Œå°±æ˜¯å·ç§¯æ ¸ä¾æ¬¡ä¸€åˆ—åˆ—æ»‘åŠ¨ï¼Œä¸è¿›è¡Œè·³è·ƒã€‚

- ç»™å®šé«˜åº¦$s_h$å’Œå®½åº¦$s_w$çš„æ­¥å¹…ï¼Œè¾“å‡ºå½¢çŠ¶æ˜¯ï¼š

$$\lfloor(n_h-k_h+p_h+s_h)/s_h\rfloor\times\lfloor(n_w-k_w+p_w+s_w)/s_w\rfloor$$

- å¦‚æœ$p_h=k_h-1$ï¼Œ$p_w=k_w-1$

$$\lfloor(n_h+s_h-1)/s_h\rfloor\times\lfloor(n_w+s_w-1)/s_w\rfloor$$

- å¦‚æœè¾“å…¥é«˜åº¦å’Œå®½åº¦å¯ä»¥è¢«æ­¥å¹…æ•´é™¤ï¼ˆæ­¥å¹…ä¸å·ç§¯æ ¸å¤§å°ç›¸å½“ï¼‰

$$(n_h/s_h)\times(n_w/s_w)$$

### æ€»ç»“

- å¡«å……å’Œæ­¥å¹…ä½¿å·ç§¯å±‚çš„è¶…å‚æ•°ï¼›
- å¡«å……åœ¨è¾“å…¥å‘¨å›´æ·»åŠ é¢å¤–çš„è¡Œã€åˆ—ï¼Œæ¥æ§åˆ¶è¾“å‡ºå½¢çŠ¶çš„å‡å°‘é‡ï¼›
- æ­¥å¹…æ˜¯æ¯æ¬¡æ»‘åŠ¨æ ¸çª—å£æ—¶çš„è¡Œã€åˆ—æ­¥é•¿ï¼Œå¯ä»¥æˆå€åœ°å‡å°‘è¾“å‡ºå½¢çŠ¶ã€‚

## ä»£ç å®ç°

- Padding

```python
import torch
from torch import nn

def comp_conv2d(conv2d, X):
    # (1ï¼Œ1)ä»£è¡¨input_channel=1, batch_size=1
    X = X.reshape((1, 1) + X.shape) # .shape+[tuple] ä½œç”¨æ˜¯æŒ‰ç»´åº¦è¿æ¥
    Y = conv2d(X)
    return Y.reshape(Y.shape[2:])
    #Y.shape returns tensor(1,1,8,8), slice[2:] returns tensor(8,8)

conv2d = nn.Conv2d(1, 1, kernel_size=3, padding=1)
#3*3
#padding=1è¡¨ç¤ºä¸Šä¸‹å·¦å³å„å¡«å……1, 10*10
X = torch.rand(size=(8, 8))
comp_conv2d(conv2d, X).shape
# Out: torch.size([8,8])
```

```python
conv2d = nn.Conv2d(1, 1, kernel_size=(5, 3), padding=(2, 1))
#12*10
comp_conv2d(conv2d, X).shape
#8*8
```

- Stride

```python
conv2d = nn.Conv2d(1, 1, kernel_size=3, padding=1, stride=2)
##10*10
comp_conv2d(conv2d, X).shape
##(10-3)/2+1=4.5, 4*4
```

```python
conv2d = nn.Conv2d(1, 1, kernel_size=(3, 5), padding=(0, 1), stride=(3, 4))
### 8*10 3*5 3*4
### floor[ï¼ˆ8-3ï¼‰/3+1]=2 florr[(10-5)/4+1]=2
comp_conv2d(conv2d, X).shape
```

## å‚è€ƒèµ„æ–™

[1] Convolution arithmetic - å„ç§å·ç§¯ Paddingã€Stride çš„åŠ¨ç”»æ¼”ç¤º ğŸ‘‰[Github](https://github.com/vdumoulin/conv_arithmetic)ğŸ‘‰[ä¸­æ–‡é•œåƒ](https://gitcode.net/mirrors/vdumoulin/conv_arithmetic)

[2] [Deep Learning and the Information Bottleneck Principle. Naftali Tishby, 2015](https://arxiv.org/abs/1503.02406)

[3] [Opening the Black Box of Deep Neural Networks via Information. Ravid Shwartz-Ziv, Naftali Tishby, 2017](https://arxiv.org/abs/1703.00810)

[4] [â€œä¿¡æ¯ç“¶é¢ˆâ€ç†è®ºæ­ç¤ºæ·±åº¦å­¦ä¹ æœ¬è´¨ï¼ŒHintonè¯´ä»–è¦çœ‹1ä¸‡é](https://zhuanlan.zhihu.com/p/29579424)

---

## Q&AğŸ¤“

**Qï¼šå·ç§¯æ“ä½œä¼šé€ æˆç‰¹å¾ä¸¢å¤±å—ï¼Ÿ**

**ğŸ™‹â€â™‚ï¸**ï¼šå…¶å®æ·±åº¦å­¦ä¹ çš„ä¸€ç§å¯è§£é‡Šæ€§ç†è®ºæå‡ºè€… Tishby è®¤ä¸ºï¼Œç¥ç»ç½‘ç»œç›¸å½“äºä¸€ä¸ª**Information Bottleneckï¼ˆä¿¡æ¯ç“¶é¢ˆï¼‰**[2][3]ï¼Œæœ¬è´¨ä¸Šæ˜¯åœ¨å¯¹ç‰¹å¾æ•°æ®è¿›è¡Œâ€œ**æœ‰æŸå‹ç¼©**â€å¾—åˆ°æœ€ç»ˆæŠ½è±¡çš„ç»“æœã€‚ï¼ˆHintonè€çˆ·å­çœ‹äº†åæƒŠå‘¼â€œè¦è¯»ä¸€ä¸‡éâ€[4]ï¼‰ä¸‹å›¾ç‰¹åˆ«å·§å¦™åœ°è¡¨ç°äº†è¿™ä¸ªç†è®ºğŸ‘‡

![information_bottleneck](Images/information_bottleneck.jpg)

æ„Ÿå…´è¶£çš„ç«¥é‹è¿™é‡Œè¿˜æ‰¾åˆ°äº†ä¸¤ä¸ªTishbyæ•™æˆå…³äºæœ¬ä¸»é¢˜çš„æ¼”è®²è§†é¢‘ğŸ¬å¯ä¾›å‚è€ƒğŸ‘‡

[![bilibili](https://i1.hdslb.com/bfs/archive/61cfe56aefdbe660babd754f3782e748b055e358.jpg@640w_400h_100Q_1c.webp)](https://www.bilibili.com/video/BV1zx411u7oG/)

[![bilibili](https://i2.hdslb.com/bfs/archive/f607b36e03455d530688a31157a0012a35e09bc0.jpg@640w_400h_100Q_1c.webp)](https://www.bilibili.com/video/BV1Rx411t7CU)
