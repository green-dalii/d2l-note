# 07 - 自动求导

---

### 🎦 本节课程视频地址 👉[Bilibil](https://www.bilibili.com/video/BV1KA411N7Px)

## 1.向量求导的链式法则

- 标量链式法则

$$
y=f(u),u=g(x) \\
{{\partial{y}}\over{\partial{x}}}={{\partial{y}}\over{\partial{u}}}{{\partial{u}}\over{\partial{x}}}
$$

- 向量链式法则(求导结果的 shape 可以参考[第六课](./06-矩阵计算.md))

$$
{{\partial{y}}\over{\partial{\bf{x}}}}={{\partial{y}}\over{\partial{u}}}{{\partial{u}}\over{\partial{\bf{x}}}} \\
(1,n)\ \ \ \ (1,)(1,n) \\
--- \\
{{\partial{y}}\over{\partial{\bf{x}}}}={{\partial{y}}\over{\partial{\bf{u}}}}{{\partial{\bf{u}}}\over{\partial{\bf{x}}}} \\
(1,n)\ \ \ \ (1,k)(k,n) \\
--- \\
{{\partial{\bf{y}}}\over{\partial{\bf{x}}}}={{\partial{\bf{y}}}\over{\partial{\bf{u}}}}{{\partial{\bf{u}}}\over{\partial{\bf{x}}}} \\
(m,n)\ \ \ \ (m,k)(k,n) \\
$$

- 向量链式法则求导示例：

假设：向量 $\bf{x,w}\in\Bbb{R}^n,\ y\in\Bbb{R}$

$z=(\langle{\bf{x,w}}\rangle-y)^2$

求 ${\partial{z}}\over{\partial{\bf{w}}}$ ？

令：

$$
a={\langle\bf{x,w}\rangle} \\
b={a-y} \\
z=b^2
$$

则：

$$
{\partial{z}\over{\partial{\bf{w}}}}=
{{\partial{z}\over{\partial{b}}}}
{{\partial{b}\over{\partial{a}}}}
{{\partial{a}\over{\partial{\bf{w}}}}
} \\
={{\partial{b^2}\over{\partial{b}}}}
{{\partial{a-y}\over{\partial{a}}}}
{\partial{{{\langle\bf{x,w}\rangle}}}\over{\partial{\bf{w}}}} \\
={2b\cdot1\cdot\bf{x}^T} \\
=2(\langle{\bf{x,w}}\rangle-y)\bf{x}^T
$$

- 矩阵链式法则求导示例

假设：矩阵 $\bf{X}\in\Bbb{R}^{m\times{n}},\ \text{向量 }\bf{w}\in{\Bbb{R^n}},\ y\in\Bbb{R^m}$

$z=||\bf{Xw-y}||^2$

求 ${\partial{z}}\over{\partial{\bf{w}}}$ ？

令：

$$
{\bf{a}=\bf{Xw}} \\
{\bf{b}=\bf{a-y}} \\
z=||\bf{b}||^2
$$

则：
$$
{\partial{z}\over{\partial{\bf{w}}}}=
{{\partial{z}\over{\partial{\bf{b}}}}}
{{\partial{\bf{b}}\over{\partial{\bf{a}}}}}
{{\partial{\bf{a}}\over{\partial{\bf{w}}}}
} \\
={{\partial{||\bf{b}||}^2\over{\partial{\bf{b}}}}}
{{\partial{\bf{a-y}}\over{\partial{\bf{a}}}}}
{\partial{{\bf{Xw}}}\over{\partial{\bf{w}}}}  \\  
={2\bf{b}^T\cdot\bf{I}\cdot\bf{X}} \\
=2({\bf{Xw}}-\bf{y})^T{\bf{X}}
$$

